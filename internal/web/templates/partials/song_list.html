{{define "song_list"}}
{{ if .Result }}
    <div class="list-header">
        <div>
            {{ if .ColID }}
            <span class="result-count" style="font-size: 16px;"><i class="fa-solid fa-folder-open"></i> æ­£åœ¨æŸ¥çœ‹: <span style="color:#10b981; margin-left: 5px;">{{ .ColName }}</span> (å…± {{ len .Result }} é¦–)</span>
            {{ else }}
            <span class="result-count"><i class="fa-solid fa-music"></i> æ‰¾åˆ° <span class="count">{{ len .Result }}</span> é¦–æ­Œæ›²</span>
            {{ if .PlaylistLink }}
                <a href="{{ .PlaylistLink }}" target="_blank" class="playlist-source-link">
                    <i class="fa-solid fa-arrow-up-right-from-square"></i> æ‰“å¼€åŸå§‹æ­Œå•
                </a>
            {{ end }}
            {{ end }}
        </div>

        <div style="display:flex; gap:10px;">
            <button type="button" class="ctrl-btn primary" onclick="playAllSongs()">
                <i class="fa-solid fa-play"></i> æ’­æ”¾å…¨éƒ¨
            </button>
            <button type="button" class="ctrl-btn primary" id="btn-batch-toggle" onclick="toggleBatchMode()">
                <i class="fa-solid fa-list-check"></i> æ‰¹é‡æ“ä½œ
            </button>
        </div>
    </div>

    <div class="batch-toolbar" id="batch-toolbar">
        <div class="batch-info">
            <div>
                <label><input type="checkbox" id="select-all-checkbox" onchange="toggleSelectAll(this)"> å…¨é€‰</label>
                <span style="margin-left: 5px; color: #718096; font-size:12px;">å·²é€‰ <span id="selected-count" style="color: #10b981; font-weight: bold;">0</span></span>
            </div>
            <button class="btn-pill btn-pill-warn" onclick="selectInvalidSongs()">
                <i class="fa-solid fa-triangle-exclamation"></i> é€‰æ‹©æ— æ•ˆ
            </button>
        </div>
        <div class="batch-actions">
            <button class="btn-pill btn-pill-switch" id="btn-batch-switch" onclick="batchSwitchSource()" disabled>
                <i class="fa-solid fa-arrows-rotate"></i> æ‰¹é‡æ¢æº
            </button>
            <button class="btn-pill btn-pill-dl" id="btn-batch-dl" onclick="batchDownload()" disabled>
                <i class="fa-solid fa-download"></i> æ‰¹é‡ä¸‹è½½
            </button>
        </div>
    </div>

    <ul class="result-list">
        {{ range .Result }}
        <li class="song-card" 
            data-id="{{.ID}}" 
            data-source="{{.Source}}" 
            data-duration="{{.Duration}}" 
            data-name="{{.Name}}" 
            data-artist="{{.Artist}}"
            data-cover="{{.Cover}}">
            
            <div class="checkbox-wrapper">
                <input type="checkbox" class="song-checkbox" onclick="event.stopPropagation(); updateBatchToolbar();">
            </div>

            <div class="cover-wrapper">
                {{ if .Cover }}
                    <img src="{{ .Cover }}" alt="{{ .Name }}" loading="lazy" onerror="this.src='https://via.placeholder.com/150?text=Music'" >
                {{ else }}
                    <div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;color:#ccc;font-size:24px;">ğŸµ</div>
                    <img src="https://via.placeholder.com/150?text=Music" style="display:none;">
                {{ end }}
            </div>
            <div class="song-info">
                <h3>
                    {{ if .Link }}
                        <a href="{{ .Link }}" target="_blank" class="song-title-link" title="æ‰“å¼€åŸå§‹é“¾æ¥">{{ .Name }}</a>
                    {{ else }}
                        {{ .Name }}
                    {{ end }}
                </h3>
                <div class="artist-line">
                    <i class="fa-regular fa-user" style="font-size:11px;"></i> {{ .Artist }}
                    {{ if .Album }} &nbsp;â€¢&nbsp; {{ .Album }}{{ end }}
                </div>
                <div class="tags">
                    <span class="tag tag-src">{{ .Source }}</span>
                    <span class="tag tag-duration">{{ if .FormatDuration }}{{ .FormatDuration }}{{ else }}-{{ end }}</span>
                    <span class="tag tag-loading" id="size-{{.ID}}"><i class="fa fa-spinner fa-spin"></i></span>
                    <span class="tag tag-loading" id="bitrate-{{.ID}}"><i class="fa fa-circle-notch fa-spin"></i></span>
                </div>
            </div>
            
            <div class="actions">
                <button type="button" class="btn-circle btn-play" title="æ’­æ”¾"
                        onclick="playAllAndJumpTo(this)">
                    <i class="fa-solid fa-play"></i>
                </button>

                <button type="button" class="btn-circle btn-switch" title="æ¢æº"
                        onclick="switchSource(this)">
                    <i class="fa-solid fa-arrows-rotate"></i>
                </button>
                
                {{ if $.ColID }}
                <button type="button" class="btn-circle btn-fav" title="ç§»å‡ºå½“å‰æ­Œå•"
                        onclick="removeSongFromCollection(this, '{{$.ColID}}', '{{.ID}}', '{{.Source}}')">
                    <i class="fa-solid fa-trash"></i>
                </button>
                {{ else }}
                <button type="button" class="btn-circle btn-fav" title="æ”¶è—åˆ°è‡ªåˆ¶æ­Œå•"
                        onclick="openAddToCollectionModal(this)">
                    <i class="fa-regular fa-heart"></i>
                </button>
                {{ end }}

                <a href="{{$.Root}}/download?id={{.ID}}&source={{.Source}}&name={{.Name}}&artist={{.Artist}}" 
                   id="dl-{{.ID}}" class="btn-circle btn-dl btn-download" title="ä¸‹è½½æ­Œæ›²" target="_blank">
                    <i class="fa-solid fa-download"></i>
                </a>

                <a href="{{$.Root}}/download_lrc?id={{.ID}}&source={{.Source}}&name={{.Name}}&artist={{.Artist}}" 
                   id="lrc-{{.ID}}" class="btn-circle btn-dl btn-lyric" title="ä¸‹è½½æ­Œè¯" target="_blank">
                    <i class="fa-solid fa-file-lines"></i>
                </a>

                <a href="{{$.Root}}/download_cover?url={{ .Cover }}&name={{ .Name }}&artist={{ .Artist }}" 
                   class="btn-circle btn-dl btn-cover" title="ä¸‹è½½å°é¢" target="_blank">
                    <i class="fa-regular fa-image"></i>
                </a>
            </div>
        </li>
        {{ end }}
    </ul>
{{ else if .Keyword }}
    {{ if not .Error }}
    <div class="no-results">
        <i class="fa-solid fa-music" style="font-size: 40px; margin-bottom: 10px; display:block;"></i>
        <p>æœªæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„èµ„æº</p>
    </div>
    {{ end }}
{{ end }}
{{end}}
