<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="referrer" content="no-referrer">
    <title>music-dl - ËÅöÂêàÊêúÁ¥¢‰∏éËß£Êûê</title>
    <link rel="icon" href="{{.Root}}/icon.png" type="image/png">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css">

    <style>
        :root {
            var(--primary-color): #10b981;
            --primary-gradient: linear-gradient(135deg, #34d399 0%, #059669 100%);
            --bg-color: #f5f7fa;
            --card-bg: #ffffff;
            --text-main: #2d3748;
            --text-sub: #718096;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            --shadow-active: 0 10px 15px -3px rgba(16, 185, 129, 0.2);
            --error-color: #e53e3e;
            
            --btn-switch-bg: #fff7ed;
            --btn-switch-text: #9a3412;
            --btn-switch-border: #fed7aa;
            
            --btn-dl-bg: #ebf8ff;
            --btn-dl-text: #2b6cb0;
            --btn-dl-border: #bee3f8;

            --btn-warn-bg: #fff5f5;
            --btn-warn-text: #c53030;
            --btn-warn-border: #feb2b2;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: #eef2f5;
            background-image: 
                radial-gradient(at 0% 0%, hsla(253,16%,7%,1) 0, transparent 50%), 
                radial-gradient(at 50% 0%, hsla(225,39%,30%,1) 0, transparent 50%), 
                radial-gradient(at 100% 0%, hsla(339,49%,30%,1) 0, transparent 50%);
            background-size: 100% 600px;
            background-repeat: no-repeat;
            color: var(--text-main);
            margin: 0;
            padding: 40px 20px 150px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            -webkit-tap-highlight-color: transparent;
        }

        .container { width: 100%; max-width: 900px; z-index: 1; }

        .search-box {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 20px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            border: 1px solid rgba(255,255,255,0.5);
            position: relative; 
            z-index: 10;
        }

        h1 {
            text-align: center; margin: 0 0 25px 0;
            font-size: 2.2rem; font-weight: 800; letter-spacing: -1px;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .search-type-switch { display: flex; justify-content: center; gap: 20px; margin-bottom: 20px; }
        .type-option { display: flex; align-items: center; gap: 8px; cursor: pointer; font-weight: 600; color: var(--text-sub); transition: color 0.2s; }
        .type-option input { margin: 0; cursor: pointer; accent-color: #10b981; }
        .type-option:hover { color: #10b981; }
        .type-option input:checked + span { color: #10b981; }

        .input-group { display: flex; gap: 10px; margin-bottom: 25px; }
        input[type="text"] {
            flex: 1; padding: 14px 24px; border: 2px solid #e2e8f0; border-radius: 50px;
            font-size: 16px; outline: none; transition: all 0.3s; background: #f8fafc; min-width: 0;
        }
        input[type="text"]:focus { border-color: #10b981; background: #fff; box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.15); }

        .search-btn {
            padding: 0 32px; border: none; border-radius: 50px; background: var(--primary-gradient); color: white;
            font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3); flex-shrink: 0;
        }
        .search-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(16, 185, 129, 0.4); }

        .error-msg {
            background: #fff5f5; color: var(--error-color); padding: 12px; border-radius: 8px; margin-bottom: 20px;
            border: 1px solid #fed7d7; text-align: center; font-size: 14px; display: flex; align-items: center; justify-content: center; gap: 8px;
        }

        .source-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid #edf2f7; }
        .source-title { font-weight: 700; color: var(--text-sub); font-size: 0.9rem; }
        .ctrl-btn { background: none; border: none; color: var(--text-sub); font-size: 12px; cursor: pointer; padding: 4px 8px; border-radius: 6px; transition: all 0.2s; }
        .ctrl-btn:hover { background: #edf2f7; color: #10b981; }
        .ctrl-btn.primary { background: #f7f9ff; color: #10b981; border: 1px solid #dbe3ff; padding: 6px 12px; font-weight: 600; border-radius: 999px; }
        .ctrl-btn.primary:hover { background: #eff3ff; }

        .source-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 12px; }
        .source-checkbox { display: none; }
        .source-card {
            background: #fff; border: 2px solid #e2e8f0; border-radius: 12px; padding: 10px 8px;
            cursor: pointer; transition: all 0.2s; position: relative; overflow: hidden;
            display: flex; flex-direction: column; align-items: center; text-align: center;
        }
        .source-name { font-size: 14px; font-weight: 700; color: #4a5568; margin-bottom: 3px; }
        .source-desc { font-size: 11px; color: #a0aec0; line-height: 1.2; font-weight: 400; }
        
        .source-checkbox:checked + .source-card { border-color: #10b981; background: #eff3ff; box-shadow: 0 4px 6px rgba(16, 185, 129, 0.15); }
        .source-checkbox:checked + .source-card .source-name { color: #10b981; }
        .source-checkbox:disabled + .source-card { opacity: 0.5; cursor: not-allowed; background: #f7fafc; border-color: #e2e8f0; }

        /* Results */
        .list-header {
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding: 10px 12px;
            background: rgba(255, 255, 255, 0.85); border: 1px solid #edf2f7; border-radius: 12px; box-shadow: var(--shadow); flex-wrap: wrap; 
        }
        .list-header .result-count { color: var(--text-main); font-size: 14px; font-weight: 700; display: flex; align-items: center; gap: 8px; }
        .list-header .result-count .count { color: #10b981; }
        
        .playlist-source-link { font-size: 14px; color: #10b981; text-decoration: none; margin-left: 15px; font-weight: 600; display: inline-flex; align-items: center; gap: 5px; transition: all 0.2s; }
        .playlist-source-link:hover { text-decoration: underline; opacity: 0.8; }
        
        .checkbox-wrapper { display: none; width: 30px; align-items: center; justify-content: center; margin-right: 10px; }
        body.batch-mode .checkbox-wrapper { display: flex; }
        body.batch-mode .song-card { padding-left: 10px; }
        
        .batch-toolbar { display: none; background: #fff; padding: 15px 20px; border-radius: 16px; box-shadow: var(--shadow); border: 2px solid #10b981; margin-bottom: 20px; flex-wrap: wrap; gap: 15px; align-items: center; justify-content: space-between; animation: slideDown 0.3s ease-out; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .batch-toolbar.active { display: flex; }
        
        .batch-info { font-size: 14px; font-weight: 600; color: var(--text-main); display: flex; align-items: center; gap: 12px; }
        .batch-actions { display: flex; gap: 10px; flex-wrap: wrap; }
        
        .btn-pill { padding: 8px 18px; border-radius: 20px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 6px; border: 1px solid transparent; }
        .btn-pill:disabled { opacity: 0.6; cursor: not-allowed; filter: grayscale(0.8); }
        .btn-pill-primary { background: #10b981; color: white; }
        .btn-pill-primary:hover { background: #059669; transform: translateY(-1px); }
        .btn-pill-fav { background: linear-gradient(135deg, #f68084 0%, #f68084 100%); box-shadow: 0 4px 15px rgba(246, 128, 132, 0.4); color: white; }
        .btn-pill-fav:hover { filter: brightness(1.05); transform: translateY(-2px); }
        
        .btn-pill-switch { background: var(--btn-switch-bg); color: var(--btn-switch-text); border-color: var(--btn-switch-border); }
        .btn-pill-switch:hover:not(:disabled) { border-color: #f97316; background: #fffaf0; }
        .btn-pill-dl { background: var(--btn-dl-bg); color: var(--btn-dl-text); border-color: var(--btn-dl-border); }
        .btn-pill-dl:hover:not(:disabled) { border-color: #3182ce; background: #ebf8ff; }
        .btn-pill-warn { background: var(--btn-warn-bg); color: var(--btn-warn-text); border-color: var(--btn-warn-border); padding: 4px 12px; font-size: 13px; }

        .result-list { list-style: none; padding: 0; display: flex; flex-direction: column; gap: 15px; }
        
        .song-card { background: #fff; padding: 15px; border-radius: 16px; box-shadow: var(--shadow); display: flex; align-items: center; transition: all 0.2s ease; position: relative; z-index: 5; border: 2px solid transparent; }
        .song-card:hover { transform: translateY(-3px); box-shadow: var(--shadow-active); }
        .song-card.playing-active { border-color: #10b981; background: #eff3ff; transform: scale(1.01); box-shadow: 0 8px 20px rgba(16, 185, 129, 0.25); }
        .song-card.selected { border-color: #10b981; background: #f7fafc; }

        .cover-wrapper { width: 64px; height: 64px; border-radius: 10px; overflow: hidden; flex-shrink: 0; margin-right: 15px; background: #eee; }
        .cover-wrapper img { width: 100%; height: 100%; object-fit: cover; }
        .song-info { flex: 1; min-width: 0; margin-right: 10px; }
        .song-info h3 { margin: 0 0 6px; font-size: 16px; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        
        .song-title-link { color: inherit; text-decoration: none; border-bottom: 1px dashed transparent; transition: all 0.2s; }
        .song-title-link:hover { color: #10b981; border-bottom-color: #10b981; }
        .external-link-icon { display: inline-block; margin-left: 5px; color: #a0aec0; transition: color 0.2s; text-decoration: none; }
        .external-link-icon:hover { color: #10b981; }

        .artist-line { font-size: 13px; color: var(--text-sub); margin-bottom: 8px; }
        .tags { display: flex; gap: 6px; }
        .tag { font-size: 10px; padding: 3px 8px; border-radius: 6px; background: #edf2f7; color: #718096; font-weight: 600; }
        .tag-src { background: #ebf8ff; color: #3182ce; text-transform: uppercase; }
        .tag-loading { color: #d69e2e; } 
        .tag-success { color: #38a169; }
        .tag-fail { color: #e53e3e; }

        .actions { display: flex; gap: 8px; }
        .btn-circle { width: 36px; height: 36px; border-radius: 50%; border: none; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s; text-decoration: none; position: relative; z-index: 10; font-size: 14px; }
        .btn-play { background: var(--primary-gradient); color: white; box-shadow: 0 4px 10px rgba(16, 185, 129, 0.3); }
        .btn-play:hover { transform: scale(1.1); }
        .btn-dl { background: #f7fafc; color: var(--text-sub); border: 1px solid #e2e8f0; }
        .btn-dl:hover { border-color: #10b981; color: #10b981; }
        .btn-switch { background: var(--btn-switch-bg); color: var(--btn-switch-text); border: 1px solid var(--btn-switch-border); }
        .btn-switch:hover { border-color: #fb923c; color: #c2410c; }
        
        .btn-fav { background: #fff5f5; color: #fc8181; border: 1px solid #fed7d7; }
        .btn-fav:hover { background: #fed7d7; color: #e53e3e; border-color: #fc8181; }

        .playlist-grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 20px; }
        .playlist-card { background: #fff; border-radius: 16px; overflow: hidden; box-shadow: var(--shadow); cursor: pointer; transition: all 0.2s; display: flex; flex-direction: column; text-decoration: none; color: inherit; }
        .playlist-card:hover { transform: translateY(-5px); box-shadow: var(--shadow-active); }
        .playlist-cover { width: 100%; aspect-ratio: 1; background: #eee; position: relative; }
        .playlist-cover img { width: 100%; height: 100%; object-fit: cover; }
        .playlist-meta { padding: 12px; flex: 1; display: flex; flex-direction: column; }
        .playlist-title { font-size: 14px; font-weight: 700; margin: 0 0 6px 0; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .playlist-author { font-size: 12px; color: var(--text-sub); margin-bottom: 4px; }
        .playlist-count { font-size: 11px; color: #a0aec0; margin-top: auto; }

        .no-results { text-align: center; padding: 60px; color: var(--text-sub); }

        .settings-float { position: absolute; top: 30px; right: 30px; background: white; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.1); color: var(--text-sub); transition: 0.2s; z-index: 20; }
        .settings-float:hover { color: #10b981; transform: rotate(90deg); }

        /* Modals */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1001; display: none; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .modal { background: white; padding: 25px; border-radius: 20px; width: 90%; max-width: 500px; max-height: 85vh; display: flex; flex-direction: column; box-shadow: 0 20px 40px rgba(0,0,0,0.2); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .modal-header h3 { margin: 0; font-size: 18px; color: var(--text-main); }
        .modal-close { cursor: pointer; color: #a0aec0; font-size: 20px; }
        .modal-close:hover { color: var(--error-color); }
        .modal-body { flex: 1; overflow-y: auto; }
        
        .cookie-list { margin: 15px 0; }
        .cookie-item { margin-bottom: 10px; }
        .cookie-item label { display: block; font-size: 12px; color: #718096; margin-bottom: 4px; font-weight: 600; }
        .cookie-item input { width: 100%; padding: 8px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 12px; box-sizing: border-box; }
        .btn-save { width: 100%; padding: 10px; background: var(--primary-gradient); color: white; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; margin-top: 10px;}

        /* Collection UI */
        .collection-item { display: flex; align-items: center; justify-content: space-between; padding: 12px; border: 1px solid #e2e8f0; border-radius: 12px; margin-bottom: 10px; transition: all 0.2s; background: #faf8f8;}
        .collection-item:hover { border-color: #fc8181; box-shadow: 0 2px 8px rgba(252,129,129,0.15); }
        .collection-info { flex: 1; min-width: 0; cursor: pointer;}
        .collection-name { font-weight: 600; font-size: 15px; color: var(--text-main); margin-bottom: 4px;}
        .collection-desc { font-size: 12px; color: var(--text-sub); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;}
        .collection-actions { display: flex; gap: 8px; }
        .col-btn { background: #fff; border: 1px solid #e2e8f0; border-radius: 6px; padding: 6px 10px; color: var(--text-sub); cursor: pointer; font-size: 13px; transition: 0.2s;}
        .col-btn:hover { color: #10b981; border-color: #10b981; }
        .col-btn.del:hover { color: #e53e3e; border-color: #e53e3e; }
        
        .create-col-form { display: flex; gap: 10px; margin-bottom: 20px; }
        .create-col-form input { flex: 1; padding: 10px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; outline: none; }
        .create-col-form input:focus { border-color: #fc8181; }

        .back-to-top { position: fixed; bottom: 120px; right: 20px; width: 45px; height: 45px; background: white; border-radius: 50%; box-shadow: 0 4px 10px rgba(0,0,0,0.15); display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 1000; opacity: 0; visibility: hidden; transition: all 0.3s ease; color: #10b981; font-size: 20px; }
        .back-to-top.show { opacity: 1; visibility: visible; transform: translateY(0); }
        .back-to-top:hover { background: #10b981; color: white; transform: translateY(-5px); }

        .aplayer.aplayer-fixed { z-index: 10000 !important; }

        @media (max-width: 768px) {
            body { padding: 0 0 200px 0; background-size: 100% 400px; }
            .container { padding: 0; width: 100%; }
            .search-box { padding: 20px 15px; border-radius: 0 0 20px 20px; margin-bottom: 20px; border-left: none; border-right: none; border-top: none; }
            h1 { font-size: 1.8rem; margin-bottom: 20px; }
            .input-group { margin-bottom: 15px; flex-direction: column; }
            .search-btn { width: 100%; height: 44px; }
            .source-grid { grid-template-columns: repeat(auto-fill, minmax(85px, 1fr)); gap: 8px; }
            .source-card { padding: 8px 4px; min-height: 40px; justify-content: center; }
            .source-name { font-size: 12px; }
            .source-desc { display: none; }
            .result-list { padding: 0 12px; gap: 12px; }
            .playlist-grid-container { padding: 0 12px; grid-template-columns: repeat(2, 1fr); gap: 12px; }
            .playlist-meta { padding: 8px; }
            .playlist-title { font-size: 12px; margin-bottom: 4px; }
            .song-card { margin: 0; padding: 12px; border-radius: 12px; align-items: flex-start; }
            .cover-wrapper { width: 54px; height: 54px; margin-right: 12px; border-radius: 8px; }
            .song-info h3 { font-size: 15px; margin-bottom: 4px; max-width: 100%; white-space: normal; }
            .artist-line { font-size: 12px; margin-bottom: 6px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 180px; }
            .tags { flex-wrap: wrap; }
            .tag { padding: 2px 5px; }
            .actions { display: grid; grid-template-columns: repeat(2, 34px); grid-auto-rows: 34px; gap: 8px; flex-shrink: 0; justify-content: flex-end; }
            .btn-circle { width: 34px; height: 34px; font-size: 13px; }
            .btn-cover { display: none !important; }
            .settings-float { top: 15px; right: 15px; width: 36px; height: 36px; }
            .modal { width: 92%; max-height: 85vh; padding: 20px; }
        }
    </style>
</head>
<body>

<div id="back-to-top" class="back-to-top" onclick="scrollToTop()">
    <i class="fa-solid fa-arrow-up"></i>
</div>

<div class="settings-float" onclick="openCookieModal()" title="Cookie ËÆæÁΩÆ">
    <i class="fa-solid fa-gear"></i>
</div>

<div class="container">
    <div class="search-box">
        <h1>üéµ <a href="https://github.com/guohuiyuan/go-music-dl" target="_blank" style="color: inherit; text-decoration: none;">music-dl</a></h1>
        <form action="{{.Root}}/search" method="get" id="search-form">
            <div class="search-type-switch">
                <label class="type-option">
                    <input type="radio" name="type" value="song" 
                        {{ if or (eq .SearchType "song") (not .SearchType) }}checked{{ end }}
                        onchange="toggleSearchType(this.value)"> 
                    <span>ÂçïÊõ≤ÊêúÁ¥¢</span>
                </label>
                <label class="type-option">
                    <input type="radio" name="type" value="playlist" 
                        {{ if eq .SearchType "playlist" }}checked{{ end }}
                        onchange="toggleSearchType(this.value)"> 
                    <span>Ê≠åÂçïÊêúÁ¥¢</span>
                </label>
            </div>

            <div class="input-group">
                <input type="text" name="q" value="{{.Keyword}}" placeholder="ÊêúÁ¥¢Ê≠åÊõ≤„ÄÅÊ≠åÊâã... ÊàñÁõ¥Êé•Á≤òË¥¥ÂàÜ‰∫´ÈìæÊé•" required autocomplete="off">
                <button type="submit" class="search-btn"><i class="fa-solid fa-magnifying-glass"></i></button>
            </div>

            <div style="display: flex; gap: 15px; justify-content: center; margin-bottom: 20px; flex-wrap: wrap;">
                <button type="button" class="btn-pill btn-pill-primary" onclick="goToRecommend()" 
                    style="background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%); border: none; box-shadow: 0 4px 15px rgba(255, 154, 158, 0.4); justify-content:center;">
                    <i class="fa-solid fa-fire"></i> Ëé∑ÂèñÊØèÊó•Êé®ËçêÊ≠åÂçï
                </button>
                <button type="button" class="btn-pill btn-pill-fav" onclick="openCollectionManager()">
                    <i class="fa-solid fa-heart"></i> ÊàëÁöÑÊî∂ËóèÂ§π
                </button>
            </div>

            {{ if .Error }}
            <div class="error-msg">
                <i class="fa-solid fa-circle-exclamation"></i> {{ .Error }}
            </div>
            {{ end }}

            <div class="source-selector">
                <div class="source-header">
                    <span class="source-title">ÊêúÁ¥¢Ê∫êËÆæÁΩÆ</span>
                    <div>
                        <button type="button" class="ctrl-btn" id="btn-all">ÂÖ®ÈÄâ</button>
                        <button type="button" class="ctrl-btn" id="btn-none">Ê∏ÖÁ©∫</button>
                    </div>
                </div>
                
                <div class="source-grid">
                    {{ range $source := .AllSources }}
                    <label>
                        <input type="checkbox" name="sources" value="{{ $source }}" class="source-checkbox"
                            data-supported="{{ index $.PlaylistSupported $source }}"
                            {{ if $.Selected }}
                                {{ range $.Selected }}{{ if eq . $source }}checked{{ end }}{{ end }}
                            {{ else }}
                                {{ range $.DefaultSources }}{{ if eq . $source }}checked{{ end }}{{ end }}
                            {{ end }}> 
                        <div class="source-card">
                            <div class="source-name">{{ $source }}</div>
                            <div class="source-desc">{{ index $.SourceDescriptions $source }}</div>
                        </div>
                    </label>
                    {{ end }}
                </div>
            </div>
        </form>
    </div>

    {{ if .Playlists }}
        <div class="playlist-grid-container">
            {{ range .Playlists }}
            <div class="playlist-card" onclick="location.href='{{$.Root}}/playlist?id={{.ID}}&source={{.Source}}'">
                <div class="playlist-cover">
                    <img src="{{ .Cover }}" loading="lazy" onerror="this.src='https://via.placeholder.com/150?text=Playlist'">
                    <span class="tag tag-src" style="position:absolute; top:5px; right:5px; margin:0;">{{ .Source }}</span>
                </div>
                <div class="playlist-meta">
                    <div class="playlist-title">
                        {{ .Name }}
                        {{ if .Link }}
                        <a href="{{ .Link }}" target="_blank" class="external-link-icon" title="ÂéªÂéüÁΩëÈ°µ" onclick="event.stopPropagation()">
                            <i class="fa-solid fa-arrow-up-right-from-square" style="font-size: 12px;"></i>
                        </a>
                        {{ end }}
                    </div>
                    <div class="playlist-author"><i class="fa-regular fa-user"></i> {{ .Creator }}</div>
                    <div class="playlist-count">ÂÖ± {{ .TrackCount }} È¶ñ</div>
                </div>
            </div>
            {{ end }}
        </div>
    {{ else if .Result }}
        <div class="list-header">
            <div>
                <span class="result-count"><i class="fa-solid fa-music"></i> ÊâæÂà∞ <span class="count">{{ len .Result }}</span> È¶ñÊ≠åÊõ≤</span>
                {{ if .PlaylistLink }}
                    <a href="{{ .PlaylistLink }}" target="_blank" class="playlist-source-link">
                        <i class="fa-solid fa-arrow-up-right-from-square"></i> ÊâìÂºÄÂéüÂßãÊ≠åÂçï
                    </a>
                {{ end }}
            </div>

            <button type="button" class="ctrl-btn primary" id="btn-batch-toggle" onclick="toggleBatchMode()">
                <i class="fa-solid fa-list-check"></i> ÊâπÈáèÊìç‰Ωú
            </button>
        </div>

        <div class="batch-toolbar" id="batch-toolbar">
            <div class="batch-info">
                <div>
                    <label><input type="checkbox" id="select-all-checkbox" onchange="toggleSelectAll(this)"> ÂÖ®ÈÄâ</label>
                    <span style="margin-left: 5px; color: #718096; font-size:12px;">Â∑≤ÈÄâ <span id="selected-count" style="color: #10b981; font-weight: bold;">0</span></span>
                </div>
                <button class="btn-pill btn-pill-warn" onclick="selectInvalidSongs()">
                    <i class="fa-solid fa-triangle-exclamation"></i> ÈÄâÊã©Êó†Êïà
                </button>
            </div>
            <div class="batch-actions">
                <button class="btn-pill btn-pill-switch" id="btn-batch-switch" onclick="batchSwitchSource()" disabled>
                    <i class="fa-solid fa-arrows-rotate"></i> ÊâπÈáèÊç¢Ê∫ê
                </button>
                <button class="btn-pill btn-pill-dl" id="btn-batch-dl" onclick="batchDownload()" disabled>
                    <i class="fa-solid fa-download"></i> ÊâπÈáè‰∏ãËΩΩ
                </button>
            </div>
        </div>

        <ul class="result-list">
            {{ range .Result }}
            <li class="song-card" 
                data-id="{{.ID}}" 
                data-source="{{.Source}}" 
                data-duration="{{.Duration}}" 
                data-name="{{.Name}}" 
                data-artist="{{.Artist}}"
                data-cover="{{.Cover}}">
                
                <div class="checkbox-wrapper">
                    <input type="checkbox" class="song-checkbox" onclick="event.stopPropagation(); updateBatchToolbar();">
                </div>

                <div class="cover-wrapper">
                    {{ if .Cover }}
                        <img src="{{ .Cover }}" alt="{{ .Name }}" loading="lazy" onerror="this.src='https://via.placeholder.com/150?text=Music'" >
                    {{ else }}
                        <div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;color:#ccc;font-size:24px;">üéµ</div>
                        <img src="https://via.placeholder.com/150?text=Music" style="display:none;">
                    {{ end }}
                </div>
                <div class="song-info">
                    <h3>
                        {{ if .Link }}
                            <a href="{{ .Link }}" target="_blank" class="song-title-link" title="ÊâìÂºÄÂéüÂßãÈìæÊé•">{{ .Name }}</a>
                        {{ else }}
                            {{ .Name }}
                        {{ end }}
                    </h3>
                    <div class="artist-line">
                        <i class="fa-regular fa-user" style="font-size:11px;"></i> {{ .Artist }}
                        {{ if .Album }} &nbsp;‚Ä¢&nbsp; {{ .Album }}{{ end }}
                    </div>
                    <div class="tags">
                        <span class="tag tag-src">{{ .Source }}</span>
                        {{ if .FormatDuration }}<span class="tag">{{ .FormatDuration }}</span>{{ end }}
                        <span class="tag tag-loading" id="size-{{.ID}}"><i class="fa fa-spinner fa-spin"></i></span>
                        <span class="tag tag-loading" id="bitrate-{{.ID}}"><i class="fa fa-circle-notch fa-spin"></i></span>
                    </div>
                </div>
                
                <div class="actions">
                    <button type="button" class="btn-circle btn-play" title="Êí≠Êîæ"
                            onclick="playAllAndJumpTo(this)">
                        <i class="fa-solid fa-play"></i>
                    </button>

                    <button type="button" class="btn-circle btn-switch" title="Êç¢Ê∫ê"
                            onclick="switchSource(this)">
                        <i class="fa-solid fa-arrows-rotate"></i>
                    </button>
                    
                    <button type="button" class="btn-circle btn-fav" title="Ê∑ªÂä†Âà∞Êî∂ËóèÂ§π"
                            onclick="openAddToCollectionModal(this)">
                        <i class="fa-regular fa-heart"></i>
                    </button>

                    <a href="{{$.Root}}/download?id={{.ID}}&source={{.Source}}&name={{.Name}}&artist={{.Artist}}" 
                       id="dl-{{.ID}}" class="btn-circle btn-dl btn-download" title="‰∏ãËΩΩÊ≠åÊõ≤" target="_blank">
                        <i class="fa-solid fa-download"></i>
                    </a>

                    <a href="{{$.Root}}/download_lrc?id={{.ID}}&source={{.Source}}&name={{.Name}}&artist={{.Artist}}" 
                       id="lrc-{{.ID}}" class="btn-circle btn-dl btn-lyric" title="‰∏ãËΩΩÊ≠åËØç" target="_blank">
                        <i class="fa-solid fa-file-lines"></i>
                    </a>

                    <a href="{{$.Root}}/download_cover?url={{ .Cover }}&name={{ .Name }}&artist={{ .Artist }}" 
                       class="btn-circle btn-dl btn-cover" title="‰∏ãËΩΩÂ∞ÅÈù¢" target="_blank" style="display:none;">
                        <i class="fa-regular fa-image"></i>
                    </a>
                </div>
            </li>
            {{ end }}
        </ul>
    {{ else if .Keyword }}
        {{ if not .Error }}
        <div class="no-results">
            <i class="fa-solid fa-music" style="font-size: 40px; margin-bottom: 10px; display:block;"></i>
            <p>Êú™ÊâæÂà∞Á¨¶ÂêàÊù°‰ª∂ÁöÑËµÑÊ∫ê</p>
        </div>
        {{ end }}
    {{ end }}
</div>

<div id="cookieModal" class="modal-overlay">
    <div class="modal">
        <div class="modal-header">
            <h3>ËÆæÁΩÆ Cookies</h3>
            <div class="modal-close" onclick="document.getElementById('cookieModal').style.display='none'"><i class="fa-solid fa-xmark"></i></div>
        </div>
        <div class="modal-body">
            <div class="cookie-list">
                {{ range $source := .AllSources }}
                <div class="cookie-item">
                    <label>{{ $source }}</label>
                    <input type="text" id="cookie-{{$source}}" placeholder="Âú®Ê≠§Á≤òË¥¥ Cookie...">
                </div>
                {{ end }}
            </div>
            <button class="btn-save" onclick="saveCookies()">‰øùÂ≠òËÆæÁΩÆ</button>
        </div>
    </div>
</div>

<div id="collectionManagerModal" class="modal-overlay">
    <div class="modal">
        <div class="modal-header">
            <h3>ÊàëÁöÑÊî∂ËóèÂ§π</h3>
            <div class="modal-close" onclick="document.getElementById('collectionManagerModal').style.display='none'"><i class="fa-solid fa-xmark"></i></div>
        </div>
        <div class="modal-body">
            <div class="create-col-form">
                <input type="text" id="newColName" placeholder="Êñ∞Âª∫Êî∂ËóèÂ§πÂêçÁß∞..." maxlength="20">
                <button type="button" class="btn-pill btn-pill-primary" onclick="createCollection()">ÂàõÂª∫</button>
            </div>
            <div id="colList" class="cookie-list" style="min-height: 150px;">
                <div style="text-align: center; color: #a0aec0; padding: 20px;">Âä†ËΩΩ‰∏≠...</div>
            </div>
        </div>
    </div>
</div>

<div id="addToCollectionModal" class="modal-overlay">
    <div class="modal" style="max-width: 400px;">
        <div class="modal-header">
            <h3>‰øùÂ≠òÂà∞Êî∂ËóèÂ§π</h3>
            <div class="modal-close" onclick="document.getElementById('addToCollectionModal').style.display='none'"><i class="fa-solid fa-xmark"></i></div>
        </div>
        <div class="modal-body">
            <div id="addColList" class="cookie-list">
            </div>
        </div>
    </div>
</div>

<div id="collectionDetailModal" class="modal-overlay">
    <div class="modal" style="max-width: 600px;">
        <div class="modal-header">
            <h3 id="colDetailTitle">Êî∂ËóèÂÜÖÂÆπ</h3>
            <div class="modal-close" onclick="document.getElementById('collectionDetailModal').style.display='none'"><i class="fa-solid fa-xmark"></i></div>
        </div>
        <div style="margin-bottom: 15px; display: flex; gap: 10px;">
            <button class="btn-pill btn-pill-primary" onclick="playCurrentCollection()"><i class="fa-solid fa-play"></i> Êí≠ÊîæÂÖ®ÈÉ®</button>
        </div>
        <div class="modal-body" id="colSongsList" style="background:#f8fafc; border-radius: 12px; padding: 10px;">
            <div style="text-align: center; color: #a0aec0; padding: 20px;">Âä†ËΩΩ‰∏≠...</div>
        </div>
    </div>
</div>

<div id="aplayer"></div>

<script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>

<script>
    window.API_ROOT = "{{.Root}}";
</script>

<script src="{{.Root}}/app.js"></script>

{{ template "videogen.html" . }}

<script src="{{.Root}}/videogen.js"></script>

</body>
</html>